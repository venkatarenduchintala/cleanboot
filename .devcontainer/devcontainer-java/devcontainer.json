// For format details, see https://aka.ms/devcontainer.json
{
    "name": "cleanboot-java-devcontainer",

    // Base image
    "image": "mcr.microsoft.com/devcontainers/base:bookworm",
    "remoteUser": "devcontainer",

    // Workspace configuration
    "workspaceFolder": "/workspace",
    "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind,consistency=cached",

    // Container shutdown behavior
    "shutdownAction": "stopContainer",

    // Features to install
    "features": {
        "ghcr.io/devcontainers/features/java:1": {
            "version": "21",
            "setAsDefault": "21",
            "installMaven": true,
            "installGradle": true,
            "jdkDistro": "tem"
        },
        "ghcr.io/devcontainers/features/common-utils:2": {
			"installZsh": false,
			"username": "devcontainer",
			"userUid": "1001",
			"userGid": "1001"
		}
    },

    // Ports
    "forwardPorts": [5005],
    "portsAttributes": {
        "5005": {
            "label": "Java Debug",
            "onAutoForward": "notify"
        }
    },

    // Post-create command to verify Java
    "postCreateCommand": "java -version && javac -version && mvn -version && gradle -version",

    // VS Code extensions and settings
    "customizations": {
        "vscode": {
            "extensions": [
                "vscjava.vscode-java-pack",
                "redhat.java",
                "vscjava.vscode-maven",
                "vmware.vscode-boot-dev-pack",
                "vmware.vscode-spring-boot",
                "vscjava.vscode-spring-initializr",
                "vscjava.vscode-java-debug"
            ],
            "settings": {
                "java.server.launchMode": "Standard",
                "java.jdt.ls.lombokSupport.enabled": true,
                "java.compile.nullAnalysis.mode": "enabled",
                "java.configuration.runtimes": [
                    {
                        "name": "JavaSE-21",
                        "path": "/usr/local/sdkman/candidates/java/21.0.9-tem/",
                        "default": true
                    }
                ]
            }
        }
    },

    // Host system requirements
    "hostRequirements": {
        "cpus": 4,
        "memory": "6gb",
        "storage": "40gb"
    }

    // Optional: Uncomment to run as root
    // "remoteUser": "root"
}
